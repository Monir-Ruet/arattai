var timeout;
$("#search").keyup(function() {
	var $this = $(this);
	if(timeout) {
		clearTimeout(timeout);
	}
	timeout = setTimeout(function() {
		var div =document.getElementById("results");
		if ($this.val().length===0) {
			div.innerHTML="";
			div.style.display="none";
			return;
		}
		div.style.display="block";
		if (window.XMLHttpRequest) {
			xmlhttp=new XMLHttpRequest();
		} else {
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.open("GET","search?q="+$this.val()+"&content=search&offset=0",true);
		xmlhttp.onreadystatechange=function() {
			if (xmlhttp.readyState==4 && xmlhttp.status==200) {
				document.getElementById("results").innerHTML=xmlhttp.responseText;}};xmlhttp.send();
			}, 1000);
});


function getAjaxData(offset)
{
	var ret;
	$.ajax({
		url : "/search?q="+$('#search').val()+"&content=main&offset="+offset,
		type : "GET",
		dataType:'json',
		success : function(response) {
			for(var i=0;i<response.length;i++){
				document.getElementsByClassName('content')[0].innerHTML+='<div class="card"><div class="card-content"><a href="/watch?v='+response[i].uniqueid+'"><div class="image"><img onerror="this.style.display=\'none\'" src="'+response[i].img+'"></div><div class="properties"><h4 class="title">'+response[i].name+'</h4></a></div></div>';
			}
			if(offset==0 && response.length==0)
				document.getElementsByClassName('main-content')[0].innerHTML='<p style="margin:auto">No #Result</p>';

		}
	});
}
function search(){
	var offset = 0;
	getAjaxData(0);
	$(window).scroll(function() {
		var pos=$(window).scrollTop();
		var bottom=$(document).height()-$(window).height();
		if(pos>=bottom-50) {
			offset+=30;
			getAjaxData(offset);
		}
	});
	// $(window).scroll(function() {
	// 	if($(window).scrollTop()+15 >= $(document).height() - $(window).height()) {
	// 		offset+=20;
	// 		getAjaxData(offset);
	// 	}

	// });
}